---
- name: Include the OS specific variables
  include_vars: "{{ ansible_os_family }}.yml"
  tags: ['nfs-client']

- name: Install required packages
  package:
    name: '{{ item }}'
    state: '{{ nfs_client__package_state }}'
  with_items:
    '{{ nfs_client__packages_name }}'
  tags: ['nfs-client']

# dump and passno provided as strings due to: https://github.com/ansible/ansible-modules-core/issues/1868
- name: Ensure mounts are registered
  mount:
    dump: '{{ item.dump | default(0) | string }}'
    passno: '{{ item.passno | default(0) | string }}'
    fstype: '{{ item.fstype | default("nfs") | string }}'
    name: '{{ item.name }}'
    opts: '{{ item.options | default(omit) }}'
    src: '{{ item.src }}'
    state: '{{ item.state | default("mounted") }}'
  with_items: '{{ nfs_client__mounts }}'
  tags: ['nfs-client']

- name: Ensure service are running
  service:
    name: '{{ item }}'
    state: '{{ nfs_client__service_state }}'
    enabled: '{{ nfs_client__service_enabled }}'
  with_items: '{{ nfs_client__service_names }}'
  tags: ['nfs-client']
